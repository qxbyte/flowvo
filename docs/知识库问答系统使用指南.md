# 知识库问答系统使用指南

## 📖 系统概述

知识库问答系统是基于Spring AI RAG架构实现的智能问答引擎，通过向量检索技术从文档库中找到最相关的内容，并结合大语言模型生成准确的答案。系统提供了完整的前端界面和丰富的交互功能。

## 🚀 快速开始

### 1. 数据库初始化

```sql
-- 执行数据库脚本
mysql -u root -p your_database < db/knowledge-base-qa.sql
```

### 2. 系统启动

```bash
# 启动后端服务
./start.sh

# 启动前端界面 (另一个终端)
cd flowvo-ui
npm run dev
```

### 3. 访问系统

- 前端界面：http://localhost:5173
- 后端API：http://localhost:8081
- 知识库问答页面：http://localhost:5173/knowledge

## 🎨 前端界面使用

### 主界面功能

#### 📝 智能问答区域
1. **问题输入框**：输入您的问题
2. **搜索参数配置**：
   - **文档分类**：选择特定分类或"全部分类"
   - **检索数量(topK)**：设置检索文档数量(3/5/10个)
   - **相似度阈值**：设置匹配精度(0.5宽松/0.7平衡/0.8严格)
3. **问答模式**：
   - **流式按钮**：实时流式返回，边生成边显示
   - **搜索按钮**：传统同步问答，一次性返回完整结果
4. **热门问题标签**：点击快速填入热门问题

#### 📊 回答结果展示
1. **问题确认**：显示您提出的问题和状态
2. **AI回答**：
   - 支持Markdown格式渲染
   - 显示响应时间和相似度得分
   - 提供复制和反馈功能
3. **信息来源**：
   - 文档标题和页码信息
   - 相似度得分
   - 点击"查看来源"可查看完整原文
4. **用户反馈**：可对回答质量进行1-5分评分

### 📋 三大功能标签页

#### 1️⃣ 最近提问
- **功能**：显示您的历史问答记录
- **信息**：问题、回答摘要、分类标签、时间、评分
- **用途**：快速回顾之前的问答内容

#### 2️⃣ 热门问题
- **功能**：显示基于趋势算法的热门问题排行
- **信息**：问题内容、热度趋势、提问次数、最后提问时间
- **用途**：发现其他用户关心的热点问题，点击可快速使用

#### 3️⃣ 知识库分类
- **功能**：显示各文档分类的统计信息
- **信息**：分类名称、文档数量、完成率、最后更新时间
- **操作**：点击"查看"可查看该分类下的所有文档详情

### 📤 文档上传功能

在文档管理页面上传文档时：

1. **选择文件**：拖拽或点击选择支持的文档格式
2. **添加标签**：为文档添加描述性标签(可选)
3. **填写描述**：为文档添加详细描述(可选)
4. **选择分类**：从下拉列表中选择文档所属分类：
   - 用户手册：产品使用指南、操作手册
   - 技术文档：开发文档、API文档、技术规范
   - 培训材料：培训课件、学习资料
   - 常见问题：FAQ、疑难解答
   - 政策制度：公司政策、规章制度
   - 其他：其他类型文档

## 🔧 API调用示例

### 同步问答
```bash
curl -X POST "http://localhost:8081/api/knowledge-qa/ask?userId=user123" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer your_token" \
  -d '{
    "question": "如何使用这个系统？",
    "category": "cat_user_manual",
    "topK": 5,
    "similarityThreshold": 0.7
  }'
```

### 流式问答
```bash
curl -X POST "http://localhost:8081/api/knowledge-qa/ask-stream?userId=user123" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer your_token" \
  -d '{
    "question": "系统有哪些功能？",
    "topK": 3,
    "similarityThreshold": 0.8
  }'
```

### 获取最近提问
```bash
curl -X GET "http://localhost:8081/api/knowledge-qa/recent-questions?limit=10" \
  -H "Authorization: Bearer your_token"
```

### 获取热门问题
```bash
curl -X GET "http://localhost:8081/api/knowledge-qa/hot-questions?limit=10&category=cat_faq" \
  -H "Authorization: Bearer your_token"
```

### 获取分类统计
```bash
curl -X GET "http://localhost:8081/api/knowledge-qa/knowledge-base-statistics" \
  -H "Authorization: Bearer your_token"
```

### 提交反馈
```bash
curl -X POST "http://localhost:8081/api/knowledge-qa/feedback?recordId=qa123&rating=5&comment=很有帮助" \
  -H "Authorization: Bearer your_token"
```

## 💡 使用技巧

### 🎯 提问技巧
1. **明确具体**：提问越具体，答案越准确
2. **关键词重点**：使用文档中可能出现的关键词
3. **分类筛选**：已知文档类型时，选择对应分类提高精度
4. **参数调节**：
   - 复杂问题增加topK数量
   - 精确匹配提高相似度阈值
   - 快速查找降低相似度阈值

### 📈 优化建议
1. **文档质量**：上传高质量、结构化的文档
2. **分类管理**：正确选择文档分类，便于后续筛选
3. **反馈参与**：积极提供反馈评分，帮助系统优化
4. **热门关注**：关注热门问题，发现共同关心的话题

### 🔍 故障排除
1. **无相关结果**：
   - 降低相似度阈值
   - 增加检索数量
   - 尝试不同的关键词表达
   - 检查是否选择了过窄的分类

2. **回答质量差**：
   - 检查相关文档是否已上传
   - 确认文档分类是否正确
   - 尝试更具体的问题描述
   - 提供负面反馈帮助系统学习

3. **响应速度慢**：
   - 减少topK数量
   - 检查网络连接
   - 尝试流式问答模式

## 📊 系统统计

系统会自动收集以下统计信息：
- 问答记录和用户反馈
- 热门问题趋势分析
- 分类文档完成率
- 系统使用频率统计

这些数据帮助系统不断优化问答质量和用户体验。

## 🔄 更新说明

### 最新功能 (v1.0.0)
- ✅ 完整的前端用户界面
- ✅ 实时流式问答支持
- ✅ 文档分类管理
- ✅ 热门问题推荐
- ✅ 用户反馈系统
- ✅ 响应式设计和暗色主题

### 即将推出
- 🔜 多语言支持
- 🔜 问答历史搜索
- 🔜 文档内容预览
- 🔜 批量文档上传
- 🔜 问答结果导出

如有问题或建议，请联系系统管理员或查看技术文档。

## 🎯 使用技巧

### 1. 问题优化建议
- **具体明确**：问题要具体，避免过于宽泛
- **关键词突出**：包含重要的关键词
- **上下文信息**：提供必要的背景信息
- **分类选择**：选择合适的文档分类进行搜索

**示例对比**:
```
❌ 不好的问题: "这个怎么用？"
✅ 好的问题: "Spring AI的ChatClient如何进行流式对话？"
```

### 2. 分类选择策略
根据问题类型选择合适的分类：
- 操作问题 → 用户手册
- 技术问题 → 技术文档  
- 学习问题 → 培训材料
- 常见问题 → FAQ
- 规则问题 → 政策制度

### 3. 参数调优
- **topK**: 检索文档数量，建议3-10个
- **similarityThreshold**: 相似度阈值，建议0.6-0.8
- **category**: 指定分类可提高准确性

## 📊 系统监控

### 问答质量指标
- **响应时间**: 平均响应时间应控制在2秒内
- **相似度得分**: 高质量答案通常得分>0.8
- **用户反馈**: 目标评分应>4.0

### 热门问题分析
系统会自动统计热门问题，趋势得分计算公式：
```
趋势得分 = 问题频次 × e^(-天数/30)
```

### 使用统计
- 每日问答次数
- 各分类使用频率
- 用户满意度评分

## 🔧 故障排除

### 常见问题

#### 1. 搜索无结果
**原因**: 
- 文档尚未向量化
- 相似度阈值过高
- 关键词不匹配

**解决方案**:
- 检查文档状态是否为COMPLETED
- 降低similarityThreshold到0.5
- 尝试不同的关键词表达

#### 2. 回答不准确
**原因**:
- 检索到的文档不相关
- 问题表达不够清晰
- 文档内容质量问题

**解决方案**:
- 增加topK值获取更多上下文
- 明确问题表达
- 检查并优化文档内容

#### 3. 响应时间过长
**原因**:
- 向量检索性能问题
- AI模型响应慢
- 网络问题

**解决方案**:
- 检查Milvus连接状态
- 优化检索参数
- 使用流式接口改善用户体验

## 📈 最佳实践

### 1. 文档管理
- **定期更新**: 保持文档内容的时效性
- **结构化组织**: 按分类合理组织文档
- **质量控制**: 确保文档内容准确、完整

### 2. 问答优化
- **建立FAQ**: 针对常见问题建立标准答案
- **持续改进**: 根据用户反馈优化回答质量
- **监控分析**: 定期分析问答数据，识别改进点

### 3. 用户体验
- **快速响应**: 优化系统性能，减少等待时间
- **结果展示**: 清晰展示答案来源和相关度
- **交互设计**: 提供友好的用户界面和操作流程

---

## 📞 技术支持

如果在使用过程中遇到问题，请：

1. 查看系统日志获取详细错误信息
2. 检查数据库连接和Milvus服务状态
3. 验证文档上传和向量化是否正常
4. 联系技术团队获得进一步支持 
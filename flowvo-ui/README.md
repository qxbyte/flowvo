# FlowVO-UI

这是FlowVO项目的React前端实现，采用Vite、React和ChakraUI构建。

## 快速开始

### 安装依赖

```bash
npm install
```

### 启动开发服务器

```bash
npm run dev
```

## 故障排除

### 空白页面或路由错误

如果您遇到空白页面或者Router相关错误，请检查：

1. **Router重复嵌套问题**：确保`App.tsx`中没有重复的`<Router>`组件，因为`main.tsx`中已经提供了`<BrowserRouter>`。

2. **依赖版本问题**：本项目使用React 18和React Router 6版本，如果您使用更新的版本，可能会出现兼容性问题。

3. **找不到模块错误**：确保所有引用的页面组件都存在。如果缺少某些页面，可以先创建简单的占位组件。

### 开发环境配置

1. 后端API配置在`vite.config.ts`中的代理设置：

```typescript
       const server: ServerConfig = {
     port: 5173,
     proxy: {
       '/api': {
         target: 'http://localhost:8080',
         changeOrigin: true,
       },
     },
   };

```

2. 确保后端服务运行在正确的端口上（默认8080）

## 主要功能

- **订单管理**：创建、查询、处理、取消订单
- **聊天对话**：创建对话、发送消息、查看历史记录
- **知识库**：管理知识文档和向量检索
- **文档管理**：上传、分类和搜索文档
- **用户认证与登录**
- **像素风格聊天页面**
- **用户设置**
- **业务系统管理**

## 技术栈

- React 18
- React Router 6
- ChakraUI
- Axios
- React Query
- Zustand (状态管理)
- TypeScript
- React Syntax Highlighter

## 功能特性

- 响应式设计，适配桌面和移动设备
- 暗黑模式支持
- 聊天气泡带有打字机效果
- 用户反馈评价系统
- 管理控制台
- 会话历史管理

## 目录结构

```
/src
  /components      # 可复用UI组件
  /layouts         # 布局组件
  /pages           # 页面组件
    /chat          # 聊天相关页面
    /dashboard     # 管理台页面
  /hooks           # 自定义Hooks
  /stores          # 全局状态
  /api             # API调用
  /utils           # 工具函数
```

## 安装与运行

### 前提条件

- Node.js 16+
- npm 7+

### 安装步骤

1. 克隆项目

```bash
git clone https://your-repository-url/flowvo-ui.git
cd flowvo-ui
```

2. 安装依赖

```bash
npm install
```

3. 启动开发服务器

```bash
npm run dev
```

4. 构建生产版本

```bash
npm run build
```

## 实现步骤详解

### 1. 搭建基础项目

```bash
# 创建Vite项目
npm create vite@latest flowvo-ui -- --template react-ts

# 安装主要依赖
cd flowvo-ui
npm install @chakra-ui/react @emotion/react @emotion/styled framer-motion
npm install @tanstack/react-query axios zustand
npm install react-router-dom react-icons
```

### 2. 配置主题和布局

- 创建src/theme.ts配置Chakra UI主题
- 设置主色调和暗黑模式
- 创建MainLayout.tsx主布局组件
- 实现响应式侧边栏

### 3. 实现聊天功能

- 创建ChatMessage组件
- 实现消息气泡
- 添加打字机效果
- 实现消息输入和发送

### 4. 管理台实现

- 创建统计卡片
- 实现数据表格
- 创建标签页切换不同管理功能
- 添加系统状态监控

### 5. 状态管理

- 使用Zustand保存全局状态
- 使用React Query处理API请求

### 6. 路由配置

- 设置页面路由
- 实现导航功能

## 开发者说明

- 使用ESLint和Prettier保持代码风格一致
- 遵循组件化开发模式，保持组件的独立性和可复用性
- 使用TypeScript强类型保证代码质量

## 注意事项

- 本应用目前处于开发阶段，API尚未完全实现
- 部分功能使用模拟数据展示

## 功能特色

### 🎮 像素聊天界面

项目包含完整的像素风格聊天界面，提供独特的游戏化体验：

#### 色彩主题设计
- **统一背景色**: `#1E0444`（深紫色背景）- 全界面统一的神秘科技感背景
- **用户消息气泡**: `#4D2788`（紫罗兰色）- 用户发送的消息使用暖紫色调，文字为 `#E8D5FF`
- **AI回复气泡**: `#16082C`（深紫红色）- AI回复使用深紫红色调，文字为 `#B8A9FF`，形成清晰对比层次
- **代码块背景**: `#0A061D`（极深紫色）- 代码块和内联代码使用极深的紫色背景，保持可读性
- **代码字体优化**: 
  - 使用高质量字体栈：`SF Mono, Monaco, Menlo, JetBrains Mono, Fira Code, Courier New, monospace`
  - 代码块字体大小：`14px`，行高：`1.5`，字重：`600`
  - 内联代码字体大小：`13px`，行高：`1.4`，字重：`600`
  - 字母间距：`0.02em`，提供舒适的阅读体验
  - 优化内边距：代码块 `12px`，内联代码 `2px 6px`
- **复制按钮优化**: 代码块右上角的复制按钮改为16x16像素的亮绿色小方块（`#00FF00`），简洁美观，取消图标和四角缺口设计
- **UI元素统一**: 顶部栏、侧边栏标题等UI元素都采用统一的紫色主题（`#1E0444`），文字为 `#B8A9FF`
- **边框优化**: 移除所有亮绿色边框，采用统一的紫色主题边框或无边框设计，营造更加和谐的视觉体验
- **代码块优化**: 移除代码块边框，采用纯背景色设计，减少视觉干扰，突出代码内容本身
- **像素风格设计**: 采用方形边角、3px边框和立体阴影效果，呈现复古8位游戏风格
- **四角缺角设计**: 每个气泡四角都有8x8像素的缺角，配合clipPath裁剪，完美还原像素游戏UI风格
- **立体效果**: 每个消息气泡都有内嵌阴影效果，模拟按钮被按下的3D立体感

#### 聊天功能特色
- **实时打字机效果**: AI回复时逐字显示，模拟真实对话体验
- **文件附件支持**: 支持图片、文档、代码等多种文件类型上传
- **代码高亮**: 内置代码块语法高亮和一键复制功能
- **会话管理**: 支持多会话切换、重命名和删除操作
- **响应式设计**: 可折叠侧边栏，适配不同屏幕尺寸

#### 用户交互优化
- **拖拽上传**: 支持文件拖拽到聊天区域直接上传
- **键盘快捷键**: 支持Enter发送、Ctrl+Enter换行等便捷操作
- **滚动跟随**: 智能滚动跟随新消息，同时允许用户自由浏览历史
- **消息时间显示**: 每条消息都显示精确的发送时间
- **按钮设计统一**: 所有按钮都采用简洁的方形设计，营造统一的现代化体验
- **功能按钮配色**:
  - 创建新对话按钮: `#F4B300`（橙黄色） - 突出新建功能的活力
  - 返回主页按钮: `#DB39A1`（粉紫色） - 与主题色呼应的导航功能
  - 模型/Agent选择按钮: 蓝色/橙色系 - 功能区分明确
  - 操作按钮: 黄色编辑、红色删除 - 符合用户认知习惯

#### 3. 按钮样式简化
**用户需求**: 截图中的按钮不需要缺口式四角

**实施方案**:
- 移除所有按钮的clipPath polygon样式
- 移除boxShadow、position: relative和四角装饰div元素
- 涉及按钮：编辑/删除按钮、新建对话按钮、返回主页按钮、收起状态按钮、模型/Agent选择按钮
- 保留消息气泡的四角缺口设计（属于聊天界面设计理念）
- 按钮变为简洁方形设计，保持颜色区分和功能性

#### 4. 聊天气泡样式优化
**用户需求**: 气泡的缺口稍微大一点点，并移除四个边框线

**实施方案**:
- 将气泡四角缺口从8px增大到12px，提供更明显的像素风格视觉效果
- 移除所有聊天气泡的边框线，采用纯背景色设计
- 调整四角装饰元素尺寸从8x8px改为12x12px，与缺口大小匹配
- 保持clipPath裁剪效果，确保四角缺口的精确呈现
- 修改适用于正常消息气泡和"正在思考"状态气泡

#### 5. 动态聊天演示组件开发
**用户需求**: 创建动态的像素聊天演示组件替换主页静态截图

**实施方案**:
- 创建独立的 `PixelChatDemo.tsx` 组件，以组件化方式引入主页
- 实现完整的聊天流程演示：用户发消息 → AI思考 → AI回复代码
- 添加从底部滑入的消息动画效果，提供流畅的视觉体验
- 集成打字机效果显示AI回复，模拟真实对话过程
- 内置代码语法高亮功能，支持彩色显示JavaScript代码
- 包含完整的像素风格UI：状态栏、消息气泡、思考动画、底部信息栏
- 自动循环演示，无需用户交互即可展示功能特色
- 保持与主聊天界面一致的视觉风格和色彩主题

**问题修复**:
- 修复消息重复显示问题，确保每条消息只显示一次
- 固定演示窗口宽度（400-500px），防止随消息内容变化而变化
- 移除自动滚动效果，避免影响主页的正常浏览体验
- 简化演示逻辑，使用固定的时间节点控制演示流程
- 优化内存管理，添加timeout清理机制防止内存泄漏
- 修复语法高亮显示问题，解决HTML标签被当作普通文本显示的错误
- 简化正则表达式规则，避免复杂匹配导致的渲染问题

### 🌓 自动颜色模式切换

本项目支持根据用户浏览器/操作系统的颜色模式偏好自动切换界面主题：

- **自动检测**: 系统会自动检测用户的浏览器或操作系统的颜色模式设置
- **实时切换**: 当用户更改系统的颜色模式设置时，界面会自动切换
- **无缝体验**: 所有页面组件都支持暗色/浅色模式

#### 如何测试

1. **macOS 用户**: 
   - 系统偏好设置 → 通用 → 外观 → 选择"浅色"或"深色"

2. **Windows 用户**: 
   - 设置 → 个性化 → 颜色 → 选择您的默认应用模式

3. **浏览器开发者工具**:
   - 打开开发者工具 → 控制台 → 运行: `document.documentElement.setAttribute('data-theme', 'dark')` 或 `document.documentElement.setAttribute('data-theme', 'light')`

#### 技术实现

- 使用 Chakra UI 的 `useSystemColorMode: true` 配置
- 在 HTML 中添加了 `color-scheme: light dark` meta 标签
- 所有组件都使用 `useColorModeValue` hook 来响应颜色模式变化

### 🔐 认证系统重构

项目已完成认证系统的重构，提供更好的用户体验：

#### 新的登录流程
1. **登录页面** (`/login`) - 统一的登录/注册入口，输入邮箱
2. **登录密码页面** (`/login-password`) - 已有用户输入密码
3. **注册密码页面** (`/register-password`) - 新用户设置密码
4. **注册昵称页面** (`/register-nickname`) - 新用户设置昵称
5. **注册成功页面** (`/register-success`) - 注册完成提示

#### 文件结构优化
- 所有认证相关页面统一移动到 `src/pages/auth/` 目录
- 删除了旧的 `LoginPage.tsx` 和 `RegisterPage.tsx`
- 重构为新的登录流程页面
- 更新了所有路由配置和导入路径

#### 退出登录修复
- 修复了退出登录后可能跳转到错误页面的问题
- 统一所有退出登录后的重定向目标为 `/login`
- 更新了所有相关组件中的重定向逻辑

#### 用户界面优化
- 删除了个人资料菜单按钮，简化用户界面
- 调整了登录页面卡片位置，提供更好的视觉体验
- 统一使用 `/login` 作为主要登录入口

#### 兼容性处理
- 保留了对旧路由 `/email-input` 和 `/register` 的重定向支持
- 自动重定向到新的登录流程入口 `/login`

#### 用户信息优化
- **字段名统一**: 修正前后端字段不匹配问题，将前端UserInfo接口中的`nickname`字段改为`name`，与后端UserInfoDTO保持一致
- **用户名称显示**: Header组件中的用户菜单显示用户昵称(`name`字段)，如果昵称为空或不存在则显示"用户"
- **注册用户名生成**: 注册流程中自动将邮箱前缀（@前面的字符串）作为username存入数据库，将用户输入的称呼作为name字段存储
- **自动聚焦功能**: 登录和注册流程中，除第一个邮箱输入页面外，其他页面跳转后自动聚焦到输入框，提升输入效率
- **用户体验**: 提供更简洁的用户标识显示，优先展示用户自定义的昵称而不是系统生成的用户名

#### 色彩规范
- **主品牌色**: `#2099F5` - 用于按钮、链接和交互元素
- **悬浮状态**: `#1a85d9` - 按钮悬浮时的深色版本
- **暗色模式**: 支持深色主题，所有颜色都有对应的暗色版本

#### Logo展示
- **登录流程**: 所有认证页面顶部显示FlowVo Logo，位置在页面宽度的20%处（1/5位置）
- **主应用**: Header组件中显示Logo，支持点击返回首页  
- **统一风格**: 所有Logo使用统一的尺寸和样式

#### 登录页面设计
- **统一按钮色彩**: 所有登录相关页面的按钮和输入框悬浮边框都采用统一的品牌色 `#2099F5`
- **顶部Logo布局**: 参考MacPaw设计，在所有登录页面顶部添加FlowVo Logo，提供品牌一致性
- **字体层级优化**: 主标题采用适中字号(`xl`)和较粗字重(`700`)突出重点，副标题使用较小字号(`sm`)保持层次感
- **响应式设计**: 登录界面适配各种屏幕尺寸，在移动端和桌面端都有良好显示效果

#### 主页展示优化
- **像素聊天演示**: 在主页展示区域显示像素聊天界面截图，提供直观的功能预览
- **动态效果**: 添加浮动动画、发光效果、缩放进入等多种CSS动画，提升视觉吸引力
- **圆润边角**: 采用20px圆角设计，配合渐变边框和阴影效果，营造现代感
- **交互体验**: 鼠标悬浮时的缩放和亮度变化，增强用户交互反馈
- **装饰元素**: 添加彩色装饰点和底部标签，突出像素聊天的游戏化特色
- **鼠标跟随特效**: 功能卡片支持鼠标跟随的渐变色扩散效果，实时追踪鼠标位置并显示彩色光晕
- **精确定位**: 每个卡片独立计算鼠标相对位置，确保渐变色中心准确对应鼠标实际位置
- **渐变色优化**: 参考设计截图采用蓝色到粉紫色的渐变效果，使用 `#2D5BFF` 到 `#FF2D92` 的渐变色彩过渡
- **平滑过渡**: 使用7个渐变停止点实现更自然的色彩过渡，并采用 `cubic-bezier(0.4, 0, 0.2, 1)` 缓动函数
- **平滑过渡**: 所有动画效果都采用平滑的CSS过渡，确保视觉体验的流畅性

## 最近更新

### 认证状态保持优化 (2024)

修复了页面刷新时自动跳转登录页的问题：

#### 问题描述
- 用户在任何页面刷新浏览器时，即使token有效也会被重定向到登录页
- 影响用户体验，特别是在PixelChatPage等需要保持状态的页面

#### 解决方案
1. **添加Loading状态**：在useAuth Hook中添加loading状态，防止在token验证完成前进行路由判断
2. **优化认证逻辑**：将token验证改为async/await模式，确保状态更新的顺序
3. **改进ProtectedRoute**：在认证状态加载期间显示加载界面，而不是立即重定向
4. **错误处理优化**：仅在明确收到401状态码时才清除登录状态，网络错误时保持当前状态

#### 技术细节
- 使用`loading`状态控制路由保护逻辑
- 在页面初始化时优先从localStorage读取认证信息
- 异步验证token有效性，失败时才清除状态
- 避免在认证验证过程中的误重定向

#### 用户体验改进
- ✅ 页面刷新时保持在当前页面（token有效时）
- ✅ 显示友好的"验证登录状态中..."加载提示
- ✅ 只在token真正过期时才跳转登录页
- ✅ 保存当前页面URL作为登录后的重定向目标

...

# Flowvo UI - 智能文档管理系统前端

基于 React + TypeScript + Chakra UI 构建的现代化文档管理系统前端界面。

## 🚀 主要功能

### 📚 文档管理
- **文档上传**: 支持拖拽上传，多种文件格式（PDF、Word、Excel、PowerPoint、文本文件等）
- **智能解析**: 自动提取文档内容并进行向量化处理
- **标签管理**: 为文档添加自定义标签，便于分类和搜索
- **元数据编辑**: 修改文档名称、描述等信息
- **状态监控**: 实时查看文档处理状态（处理中、已完成、失败）

### 🔍 智能搜索
- **语义搜索**: 基于向量相似度的智能内容搜索
- **多维度搜索**: 支持文档名称、标签、内容的综合搜索
- **搜索结果高亮**: 清晰显示匹配度和相关内容片段

### 🔐 用户认证与安全
- **JWT Token 认证**: 安全的用户身份验证
- **自动 Token 验证**: 实时检测 Token 有效性
- **权限控制**: 基于用户身份的访问控制
- **数据隔离**: 用户文档数据完全隔离

### 💻 现代化 UI/UX
- **响应式设计**: 支持桌面端和移动端
- **深色/浅色主题**: 智能主题切换
- **实时状态反馈**: 加载状态、错误提示、成功反馈
- **拖拽上传**: 现代化的文件上传体验

## 🛠 技术栈

- **框架**: React 18 + TypeScript
- **UI组件库**: Chakra UI
- **状态管理**: Zustand
- **路由**: React Router DOM
- **HTTP客户端**: Axios
- **构建工具**: Vite
- **开发工具**: ESLint + TypeScript

## 📦 安装与运行

### 环境要求
- Node.js >= 16.0.0
- npm >= 8.0.0

### 安装依赖
```bash
cd flowvo-ui
npm install
```

### 开发环境运行
```bash
npm run dev
```

### 生产环境构建
```bash
npm run build
```

## 🔧 配置说明

### API 代理配置
前端通过 Vite 代理转发 API 请求到后端服务：

```typescript
// vite.config.ts
server: {
  proxy: {
    '/api': {
      target: 'http://localhost:8080',
      changeOrigin: true,
      secure: false
    }
  }
}
```

### 环境变量
创建 `.env.local` 文件配置环境变量：

```bash
VITE_API_BASE_URL=http://localhost:8080
VITE_UPLOAD_MAX_SIZE=50MB
```

## 📋 使用指南

### 1. 用户登录
访问 `/login` 页面进行用户登录，系统会自动验证 Token 并保存用户信息。

### 2. 文档上传
1. 点击"上传文档"按钮
2. 拖拽文件或点击选择文件
3. 添加标签和描述（可选）
4. 点击上传

### 3. 文档管理
- **查看文档**: 点击文档名称查看详细信息
- **编辑信息**: 右键菜单选择"编辑信息"
- **重新处理**: 对处理失败的文档可重新处理
- **删除文档**: 右键菜单选择"删除"

### 4. 智能搜索
在搜索框中输入关键词，系统会：
- 搜索文档标题和标签
- 进行语义内容搜索
- 按相关度排序结果

## 🏗 项目结构

```
flowvo-ui/
├── src/
│   ├── components/          # 可复用组件
│   │   ├── DocumentUpload.tsx    # 文档上传组件
│   │   ├── ProtectedRoute.tsx    # 路由保护组件
│   │   └── Header.tsx            # 页面头部
│   ├── pages/              # 页面组件
│   │   ├── documents/           # 文档管理页面
│   │   ├── auth/               # 认证相关页面
│   │   └── home/               # 首页
│   ├── stores/             # 状态管理
│   │   └── documentStore.ts     # 文档状态管理
│   ├── hooks/              # 自定义 Hooks
│   │   └── useAuth.tsx          # 认证 Hook
│   ├── utils/              # 工具函数
│   │   └── api.ts              # API 接口定义
│   └── layouts/            # 布局组件
├── public/                 # 静态资源
└── package.json           # 项目配置
```

## 🔐 认证流程

1. **登录**: 用户输入凭据，后端返回 JWT Token
2. **Token 存储**: Token 保存在 localStorage 中
3. **自动验证**: 每次页面刷新时验证 Token 有效性
4. **请求拦截**: Axios 自动在请求头中添加 Authorization
5. **错误处理**: Token 过期时自动跳转到登录页

## 🎨 主题定制

系统支持深色和浅色主题，可通过 Chakra UI 的 `useColorMode` 进行切换：

```typescript
const { colorMode, toggleColorMode } = useColorMode();
```

## 📊 状态管理

使用 Zustand 进行状态管理，主要状态包括：

- **文档列表**: documents
- **搜索结果**: searchResults  
- **加载状态**: loading
- **错误信息**: error
- **用户信息**: userInfo (通过 AuthContext)

## 🔄 API 接口

### 文档管理接口
- `POST /api/v1/documents/upload` - 上传文档
- `GET /api/v1/documents/user/{userId}` - 获取用户文档
- `DELETE /api/v1/documents/{documentId}` - 删除文档
- `PUT /api/v1/documents/{documentId}` - 更新文档信息
- `POST /api/v1/documents/search` - 搜索文档

### 认证接口
- `POST /api/auth/login` - 用户登录
- `GET /api/auth/me` - 获取当前用户信息
- `POST /api/auth/logout` - 用户退出

## 🐛 错误处理

系统提供完善的错误处理机制：

1. **网络错误**: 显示网络连接问题提示
2. **认证错误**: 自动跳转到登录页面
3. **业务错误**: 显示具体的错误信息
4. **文件上传错误**: 显示文件类型或大小限制提示

## 🔮 功能特性

### 响应式设计
- 支持桌面、平板、手机等多种设备
- 自适应布局和交互方式

### 用户体验优化
- 实时状态反馈
- 优雅的加载动画
- 智能的错误提示
- 直观的操作流程

### 性能优化
- 组件懒加载
- 图片延迟加载
- 请求去重和缓存
- 虚拟滚动（大列表）

## 🤝 开发贡献

1. Fork 项目
2. 创建功能分支: `git checkout -b feature/AmazingFeature`
3. 提交更改: `git commit -m 'Add some AmazingFeature'`
4. 推送分支: `git push origin feature/AmazingFeature`
5. 提交 Pull Request

## 📄 许可证

本项目基于 MIT 许可证开源。

## 🆘 问题反馈

如果您在使用过程中遇到问题或有改进建议，请：

1. 查看 [常见问题](docs/FAQ.md)
2. 搜索已有的 [Issues](../../issues)
3. 创建新的 Issue 描述问题

---

**Happy Coding! 🎉**
